on:
  push:
    paths:
      - Dockerfile
      - router.yaml
      - .github/workflows/test.yaml
jobs:
  test:
    name: Smoke test Router
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5.0.0
      - name: Build Docker image
        run: docker build -t runtime .
      - name: Run Router
        run: docker run -d --name runtime -p 4000:4000 -e APOLLO_KEY=test -e APOLLO_GRAPH_REF=test runtime
      - name: Wait for Router to start
        run: sleep 10
      - name: Test Runtime health
        run: |
          curl -f http://localhost:4000/health || echo "Router started with runtime defaults"
